# PR-034 Preflight Checklist

## Metadata
- **PR ID:** PR-034
- **Title:** Infra Agent ops guardrails (compose/health/logs only)
- **Persona:** persona:core
- **Scope class:** in-scope
- **In-scope files:** `packages/core/ops_guardrail.py`, `tests/test_ops_guardrail.py`, `docs/PR_LOG.md`, `docs/PR_STATE.md`, `docs/pr_notes/PR-034.md`

## Scope Checklist
- [x] All touched files are in `packages/core/`, `tests/`, or `docs/`
- [x] No UI, billing, or platform-specific code
- [x] No new third-party dependencies
- [x] OpsCommandResult is frozen Pydantic with `extra="forbid"`

## Implementation
1. Define `OpsGuardrail` with prefix allowlist + deny-pattern blocklist
2. Default allowed: docker compose/ps/logs, curl, tail, journalctl, system monitoring commands
3. Deny patterns: `rm -rf`, `mkfs`, `dd`, `shutdown/reboot/halt`, `chmod 777`, write to `/dev/`
4. Word-boundary prefix matching to prevent `ss` matching `ssh`
5. Add 44 tests in `tests/test_ops_guardrail.py`

## Quality Gates
- [x] `ruff check .` — PASS
- [x] `pytest -q` — 343 passed
